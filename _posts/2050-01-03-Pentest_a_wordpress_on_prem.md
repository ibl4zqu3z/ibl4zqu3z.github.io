---
title: "Pentest a WordPress on-prem con validación de impacto hasta root"
excerpt: "Pentest sobre una academia (anonimizada): compromiso inicial a través de WordPress, evidencia de ejecución en el host y prueba de impacto con escalada local a root."
categories:
  - casos-de-estudio
#tags: [wordpress, pentesting, web, hardening, privilege-escalation, informes]
featured: true
header:
  image: /assets/images/casos-de-estudio/caso_wordpress_onprem.png
  teaser: /assets/images/casos-de-estudio/caso_wordpress_onprem.png
---

<div class="alert alert-danger" role="alert">

<h3>Aviso</h3>
Por seguridad, este caso está <span>anonimizado</span> y muestra <span>evidencias controladas</span>. El objetivo es mostrar metodología, calidad de análisis y capacidad de priorización de riesgos, no “exponer” al cliente auditado.

</div>

## Contacto del cliente

Cliente se pone en contacto con una preocupacion ya que tiene una academia que depende de su web para captar matrículas y durante varias semanas habían observado eventos que no encajaban con el uso normal.

Comentaba que "el administrativo" que lleva la web habia recibido varios correos de notificación asociados al formulario de contacto fuera de horario habitual y con patrones similares. Ademas vieron que habia muchas visitas a paginas que no eran de cursos, ni a artículos del blog.

En breve iban a tener una campaña de captacion de nuevos alumnos de academia y queria comprobar la web.

Desde la primera llamada noté que el cliente necesitaba una traducción clara: qué significa realmente “comprobar la web” y qué se puede esperar de una prueba de seguridad. Les expliqué el concepto de forma directa: un pentest es una evaluación controlada donde se simulan técnicas reales de ataque para identificar debilidades explotables, medir el impacto y convertirlo en un plan de corrección priorizado. No es un escaneo automático, ni un informe genérico; es una prueba con hipótesis, verificación y evidencias reproducibles.

También dejé claro desde el principio el marco de seguridad y control:

- No íbamos a realizar acciones destructivas ni pruebas de denegación de servicio.
- Cualquier extracción de datos sería mínima y estrictamente para evidenciar el riesgo.
- Todo se haría dentro de un alcance pactado y con reglas de juego (ventanas horarias, límites de intentos, canales de comunicación, criterios de parada).

Con esa explicación, el cliente entendió el valor inmediato: no buscaban “que no haya fallos”, buscaban **saber qué riesgo real tenían**, si era explotable, y qué arreglar primero para reducir exposición.

### Primera reunión: la preocupación real detrás de “revisar la web”

En la reunión inicial, el cliente describió el entorno: la web corporativa estaba montada sobre WordPress, pero no en un hosting externo. La alojaban en un **servidor físico propio** en sus instalaciones. 

Ese detalle cambió el matiz del riesgo: un fallo en WordPress no es solo un fallo de “la web”, puede convertirse en control del servidor que ellos mismos operan.

Su problemática se resumía en cuatro puntos:

1. **Protección de datos de formularios** (leads, mensajes, posibles adjuntos).  
2. **Evitar toma de cuentas administrativas** (por impacto reputacional y operativo).  
3. **Evitar modificaciones no autorizadas del sitio** (defacement o inyección de contenido).  
4. **Confirmar si un compromiso de WordPress podría llegar al servidor** (por estar on-prem).

Acordamos entonces el enfoque del caso: una evaluación centrada en WordPress como aplicación, con un punto clave añadido: si durante la prueba se conseguía ejecución en el host derivada del compromiso de WordPress, se validaría el impacto máximo de forma controlada (escalada local) para poder cuantificar el riesgo real.

### Antes de tocar nada: documentación y autorización
Una vez de acuerdo, pasamos a la parte que diferencia un trabajo serio de una “prueba informal”: **documentar y firmar el marco del encargo**. Esto es lo que se preparó y se presentó para firma antes de iniciar cualquier acción técnica:

- **Acuerdo de confidencialidad (NDA)**, para proteger información, evidencias y hallazgos.
- **Contrato de prestación de servicios** y **SOW (Statement of Work)** con alcance, entregables y condiciones.
- **Carta de autorización de pruebas (Authorization to Test)** firmada por el cliente: activos autorizados, fechas, ventanas horarias y representante responsable.
- **Rules of Engagement (RoE)**: reglas de juego operativas (técnicas permitidas/prohibidas, límites, kill switch, contactos, criterios de parada).
- **Anexo de alcance técnico** (dominios/subdominios/IPs/entornos) para eliminar ambigüedades.
- **Cláusulas de protección de datos / DPA (RGPD)** por el tratamiento potencial de  (datos personales identificativos: formularios, usuarios, logs).
- **Plan de gestión de evidencias y custodia**: cifrado, acceso, retención y borrado seguro.
- **Plan de comunicación y escalado**: quién se avisa y cuándo, especialmente si aparecían hallazgos críticos.
- **Aceptación de riesgo operativo**: reconocimiento de posibles efectos colaterales y obligación de backups previos.

En paralelo, el cliente me aportó lo mínimo imprescindible para trabajar con control: inventario de dominios autorizados, confirmación de su propiedad, contactos disponibles durante la ventana de pruebas, y verificación de backups y procedimiento de restauración.

Con el marco firmado y el alcance definido, mi trabajo ya no era “mirar la web”: era una evaluación formal, controlada y defendible, con trazabilidad desde el acuerdo hasta el informe final.


## Preparacion de la prueba

## Comienzo del pentest

Con todo preparado, empecé por un reconocimiento pasivo con el fin de entender qué exponía realmente la web desde fuera. Luego pase a un reconocimiento activo con una enumeración activa controlada. La idea era simple: mapear superficie. Comprobacion de exposicion del servidor, puertos, servicios, versiones, etc. Qué plugins se dejaban intuir, cómo se comportaba el login, si el entorno tenía rate-limit, si XML-RPC estaba habilitado, etc.

Tras varias horas de trabajo la superficie estuvo clara. Con la superficie clara pase a comprobar los puntos más probables de entrada de WordPress: autenticación, formularios, adjuntos, un plugin con mantenimiento irregular. Y con esa hipótesis pasé a las pruebas orientadas a impacto.

Ahí fue cuando el caso se definió. El vector inicial permitió demostrar compromiso de la capa WordPress de forma controlada y, lo más importante, confirmar que ese compromiso no se quedaba “en la web”. La ejecución que obtuve cambió el riesgo para el cliente en segundos, porque su WordPress no estaba en un hosting externo; estaba en un servidor físico suyo, dentro de su empresa.

Si pude elevar privilegios, el incidente ya no es solo de la web, es del activo completo.
La escalada la realicé como prueba de concepto, sin persistencia y sin acciones destructivas. El objetivo era la evidencia concluyente. En el momento en que obtuve permisos root, paré. No había nada más que “ganar” técnicamente y sí mucho que preservar: integridad del entorno, trazabilidad de evidencias y claridad del informe.

En paralelo, se activó el circuito de comunicación acordado: notificación inmediata al contacto técnico del cliente, explicando impacto, alcance real de lo demostrado y mitigaciones urgentes. No un informe largo, sino un aviso de emergencia estructurado: qué se ha validado, qué implica, qué se debe cerrar ya mismo para reducir exposición mientras se trabaja en la corrección definitiva.

A partir de ahí el trabajo cambió de modo. Dejé de “buscar” y pasé a “ordenar”: clasificar hallazgos, vincularlos a la cadena completa y convertirlo en un plan ejecutable. Primero, el vector inicial en WordPress. Segundo, la condición que habilitó la escalada. Tercero, las medidas de contención: MFA, rate-limit, reducción de superficie, permisos, y observabilidad mínima para detectar intentos futuros.

Cuando llegó la reunión de cierre, el cliente ya no hablaba de “revisar la web”. Hablaba de riesgo en términos correctos: qué expone, qué impacto tiene, qué se arregla hoy, qué se programa para la semana siguiente y qué cambios estructurales evitan que un fallo en WordPress vuelva a escalar hasta el control total del servidor.

## Resumen ejecutivo

Una academia aloja su sitio corporativo en un **servidor físico propio** en sus instalaciones. La evaluación se centró en **WordPress** (core/temas/plugins y configuración expuesta por HTTP/HTTPS). A partir del compromiso de la aplicación se validó impacto en el host: **ejecución en el servidor como usuario del servicio web** y **escalada local a `root`** mediante una condición de configuración insegura.

**Impacto principal (consecuencia del compromiso de WordPress):**
- Control de integridad del sitio (modificación de contenido, instalación de backdoors en tema/plugin).
- Acceso a información de formularios (leads, mensajes, adjuntos).
- Posibilidad de credenciales y secretos expuestos.
- **Control total del servidor (root)** como prueba de impacto.

**Causa raíz (alto nivel):**
- Superficie WordPress con un componente/flujo explotable que habilita ejecución en el host.
- Medidas de contención insuficientes en el servidor para limitar el impacto al nivel de aplicación.

**Prioridad de remediación:**
1. Cerrar el vector inicial en WordPress (actualización/retirada del componente afectado, control estricto de adjuntos, reducción de superficie).
2. Eliminar la condición que permitió escalada a root.
3. Endurecer autenticación y reducir exposición (MFA, rate-limit, endurecimiento de endpoints).

---

## Alcance y reglas

### En alcance

- Sitio WordPress corporativo publicado por HTTPS.

- Endpoints asociados a WordPress:
  - `/wp-login.php` y `/wp-admin/`
  - `/wp-json/` (API REST)
  - `/xmlrpc.php` (si estaba activo)

- Componentes WordPress: core, tema activo y plugins detectados desde la superficie web.

- Validación de impacto en host **derivada** del compromiso de WordPress (prueba controlada de escalada local).

### Fuera de alcance (explícito)

- Auditoría integral del servidor (hardening completo del SO, servicios no-web, revisión exhaustiva de configuración global).
- Denegación de servicio y pruebas disruptivas.
- Ingeniería social.

### Criterio de evidencia
- Evidencia mínima, reproducible y no destructiva.
- Acceso a datos reales limitado al mínimo necesario para probar impacto.

## Entorno (anonimizado) y modelo de despliegue
- **Hosting**: servidor físico on-prem (academia).
- **Aplicación**: WordPress.
- **Stack típico**: servidor web + PHP + base de datos.
- **Datos tratados**: formularios de contacto/solicitud de información, posibles adjuntos, usuarios WordPress (admin/editor).

---

## Metodología aplicada
Metodología práctica alineada con OWASP Web Security Testing Guide (WSTG) y checklist específico para WordPress:

1. **Reconocimiento pasivo**  
   Tecnología, huellas de WordPress, endpoints habituales, políticas y metadatos expuestos.

2. **Enumeración controlada**  
   Superficie WordPress: usuarios, plugins/temas, REST/XML-RPC, rutas típicas, ficheros sensibles accesibles.

3. **Validación de control de acceso y autenticación**  
   Comportamientos de login, enumeración de usuarios, protección ante intentos, exposición de paneles.

4. **Pruebas sobre entradas y flujos sensibles**  
   Formularios, adjuntos, endpoints y lógica asociada.

5. **Compromiso controlado y prueba de impacto**  
   Evidencia de ejecución en el host en contexto del servicio web y escalada local a root como validación del impacto máximo derivado del vector web.

6. **Remediación**  
   Recomendaciones priorizadas por coste/impacto con “quick wins” y cambios estructurales.

## Cadena de ataque (resumen técnico)

1. **Descubrimiento de superficie WordPress**: endpoints, plugins y señales de configuración.  
2. **Vector inicial**: debilidad explotable en un flujo WordPress (componente/funcionalidad asociada a formularios/adjuntos o gestión del contenido).  
3. **Ejecución en el servidor**: acciones ejecutadas en contexto del servicio web (`www-data`/equivalente).  
4. **Escalada local**: condición insegura del host que permitió elevar privilegios hasta `root`.  
5. **Validación de impacto**: evidencia puntual de `root` sin acciones destructivas.

## Hallazgos (resumen)

<table class="table table-dark table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">ID  </th>
      <th scope="col">Severidad</th>
      <th scope="col">Hallazgo</th>
      <th scope="col">Impacto</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">B-01</th>
      <td>Alta</td>
      <td>Compromiso de WordPress con ejecución en host</td>
      <td>Control de aplicación y punto de apoyo en servidor</td>
    </tr>
    <tr>
      <th scope="row">B-02</th>
      <td>Critica</td>
      <td>Escalada local a `root` tras compromiso de WordPress </td>
      <td>Control total del servidor</td>
    </tr> 
    <tr>
      <th scope="row">B-03</th>
      <td>Media</td>
      <td>Enumeración de usuarios / señales de autenticación</td>
      <td>Facilita ataque dirigido</td>
    </tr>
    <tr>
      <th scope="row">B-04</th>
      <td>Media</td>
      <td>Rate-limit/bloqueo insuficiente en autenticación</td>
      <td>Incrementa riesgo de toma de cuentas</td>
    </tr>   
  </tbody>
</table>

## B-01 — Compromiso de WordPress con ejecución en el host (Alta)
### Descripción
Se identificó un vector que permitió pasar de interacción web a **capacidad de ejecución** en el servidor bajo el usuario del servicio web. En un entorno on-prem, esto es un cambio de dimensión: ya no es solo “riesgo web”, es **riesgo de activo**.

### Evidencia (controlada)
- Confirmación de contexto de ejecución correspondiente al usuario del servicio web.
- Evidencia de acceso a rutas del proyecto WordPress y lectura limitada de configuración de la aplicación (sin exfiltración masiva).

### Impacto
- Persistencia a nivel aplicación (modificación de tema/plugin).
- Acceso a datos tratados por WordPress (formularios, usuarios, adjuntos).
- Punto de partida para escalada local y, potencialmente, movimiento lateral si el servidor comparte red con otros activos.

### Causa raíz (alto nivel)
- Componente/flujo de WordPress expuesto con controles insuficientes (validación, permisos, configuración o mantenimiento).

### Remediación
- Actualizar/retirar el componente afectado.
- Revisar permisos del filesystem de WordPress, especialmente `wp-content/`.
- Restringir ejecución donde no aplique (por ejemplo, endurecer políticas sobre directorios de subida).
- Implementar monitorización de integridad (hashing de ficheros críticos, alertas ante cambios).

## B-02 — Escalada local a `root` tras el compromiso de WordPress (Crítica)
### Descripción
Sin realizar auditoría integral del servidor, se validó el **impacto máximo**: partiendo de ejecución como usuario del servicio web, se alcanzó **`root`** mediante una condición de configuración insegura. Esta prueba es determinante para el negocio: cualquier compromiso web pasa a ser **control total del servidor físico**.

### Evidencia (controlada)
- Confirmación de privilegios `root` en la prueba de concepto.
- Evidencia de la condición habilitante (configuración/permisos) que hace viable la escalada.

> Nota operativa: la evidencia se mantuvo al mínimo imprescindible. No se realizaron acciones persistentes ni destructivas con privilegios elevados.

### Impacto
- Acceso completo a ficheros, base de datos y usuarios del servidor.
- Posible manipulación del servicio web, logs y mecanismos de seguridad.
- Riesgo de pivot hacia otros activos si el servidor está en red interna sin segmentación.

### Causa raíz (alto nivel)
- Falta de contención del impacto en host: permisos o configuración que permiten que un usuario de servicio termine ejecutando acciones con privilegios elevados.

### Remediación prioritaria
- Eliminar la condición que permitió escalada (permisos, scripts ejecutados por root, configuración de `sudo`, binarios SUID, tareas programadas, pertenencia a grupos privilegiados, etc., según aplique).
- Endurecer el modelo de privilegios: mínimo privilegio real para el usuario del servicio web.
- Separación efectiva: aislar WordPress y sus procesos para que un incidente web no implique control del host.

## B-03 — Enumeración de usuarios y señales de autenticación (Media)
### Descripción
Se detectaron señales que facilitan inferir usuarios válidos (metadatos, patrones de respuesta o exposición vía endpoints). Esto reduce el coste de ataques dirigidos y eleva el riesgo de toma de cuentas.

### Impacto
- Disminuye la entropía del ataque (el atacante ya “tiene” parte del material).
- Facilita campañas de password spraying o ataques contra cuentas privilegiadas.

### Remediación
- Reducir superficie de enumeración en WordPress (ajustes de REST si no se usa, restricciones de autor archives, mensajes de error homogéneos).
- MFA obligatorio para administradores y editores.
- Políticas de contraseñas y rotación coherentes con riesgo.

## B-04 — Controles insuficientes ante intentos de autenticación (Media)
### Descripción
Se observó ausencia o debilidad de rate-limit/bloqueo en flujos de autenticación. En WordPress esto se agrava si XML-RPC está activo o si existen rutas alternativas de login.

### Impacto
- Incrementa viabilidad de fuerza bruta controlada, password spraying y abuso de credenciales filtradas.
- Eleva carga operativa y aumenta probabilidad de acceso no autorizado.

### Remediación
- Rate-limit y bloqueo progresivo.
- MFA y allowlist administrativa (si existe VPN o IPs estáticas).
- Deshabilitar XML-RPC si no es estrictamente necesario o protegerlo de forma fuerte.


## Priorización de remediación (plan por fases)
### Fase 0 (inmediata)
- Corregir vector inicial de WordPress (componente/flujo afectado).
- Eliminar condición de escalada a root.
- MFA obligatorio para cuentas privilegiadas.
- Revisar y retirar artefactos peligrosos (backups accesibles, ficheros de prueba, rutas sobrantes).

### Fase 1 (corto plazo)
- Hardening WordPress: permisos, política de subidas, reducción de superficie, revisión de plugins imprescindibles.
- Rate-limit y protección del login y endpoints alternativos.
- Monitorización mínima: alertas ante cambios en ficheros del core/tema/plugins.

### Fase 2 (medio plazo)
- Aislamiento y contención: segmentación, separación de roles, políticas de acceso administrativo estrictas.
- Mejora de logging y retención; correlación básica de eventos.
- Procedimiento de mantenimiento: inventario de plugins, ventanas de actualización, revisión de exposición.

---

## Entregables generados
- Documento de alcance, reglas y limitaciones.
- Inventario de superficie WordPress (endpoints y componentes observables).
- Evidencias reproducibles por hallazgo (capturas y trazas seleccionadas).
- Matriz de riesgos y priorización (enfoque negocio + técnico).
- Plan de remediación por fases con acciones concretas.

---

## Lectura final (por perfiles técnicos y no técnicos)
Este caso muestra un patrón recurrente en entornos on-prem: una debilidad en WordPress no se queda en “la web”. Si el servidor no tiene contención suficiente, el incidente escala a control total del activo físico. La decisión crítica no es solo “actualizar plugins”, sino diseñar el entorno para que un fallo web no pueda terminar en `root`.
